name: "Run Android Medium test via native"
inputs:
  script:
    required: true
    type: string
  android-api-level:
    required: true
  android-target:
    required: true
  android-arch:
    required: true

runs:
  using: "composite"

  steps:
    - run: sudo apt update
      shell: bash

# TODO cache
    - name: "Install Android SDK"
      run:  sudo apt install android-sdk
      shell: bash
    - run: ls -a /usr/lib/android-sdk
      shell: bash

    - run: sudo cp -rf /usr/lib/android-sdk ~/android-sdk
      shell: bash
    - run: sudo chown -R $(id -u):$(id -g) ~/android-sdk
      shell: bash

    - run: echo "ANDROID_HOME=~/android-sdk" >> $GITHUB_ENV
      shell: bash
    - run: echo "${{ env.ANDROID_HOME }}/platform-tools/bin" >> $GITHUB_PATH
      shell: bash
    - run: echo "${{ env.ANDROID_HOME }}/tools/bin" >> $GITHUB_PATH
      shell: bash

    - run: mkdir ~/tmp
      shell: bash

    - run: >
        wget
        https://dl.google.com/android/repository/commandlinetools-linux-10406996_latest.zip
        -P ~/tmp
      shell: bash

    - run: >
        unzip
        ~/tmp/commandlinetools-linux-10406996_latest.zip
        -d ~/tmp
      shell: bash

    - run: mkdir ~/android-sdk/cmdline-tools/latest -p
      shell: bash
    - run: cp -r ~/tmp/cmdline-tools/* ~/android-sdk/cmdline-tools/latest
      shell: bash
    - run: ls ~/android-sdk/cmdline-tools/latest -a
      shell: bash
    - run: ls ~/android-sdk/cmdline-tools/latest/bin -a
      shell: bash
    - run: echo "${{ env.ANDROID_HOME }}/cmdline-tools/latest/bin" >> $GITHUB_PATH
      shell: bash

    - run: sdkmanager -h
      shell: bash
    - run: where sdkmanager
      shell: bash

    - run: echo "dev"
      shell: bash
