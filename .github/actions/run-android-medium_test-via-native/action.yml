name: "Run Android Medium test via native"
inputs:
  script:
    required: true
    type: string
  android-api-level:
    required: true
  android-target:
    required: true
  android-arch:
    required: true

runs:
  using: "composite"

  steps:
    - run: sudo apt update
      shell: bash

# TODO cache
    - name: "Install Android SDK"
      shell: bash
      run:  sudo apt install android-sdk

    # `/usr/lib`以下に配置されたままだと、`android-sdk`の利用に`sudo`が必要なので、移動する
    - shell: bash
      run: sudo cp -rf /usr/lib/android-sdk ~/android-sdk
    - shell: bash
      run: sudo chown -R $(id -u):$(id -g) ~/android-sdk
    - shell: bash
      run: echo "ANDROID_HOME=~/android-sdk" >> $GITHUB_ENV
    - shell: bash
      run: echo "${{ env.ANDROID_HOME }}/platform-tools/bin" >> $GITHUB_PATH
    - shell: bash
      run: echo "${{ env.ANDROID_HOME }}/tools/bin" >> $GITHUB_PATH

    - run: mkdir ~/tmp
      shell: bash

    - run: >
        wget
        https://dl.google.com/android/repository/commandlinetools-linux-10406996_latest.zip
        -P ~/tmp
      shell: bash

    - run: >
        unzip
        ~/tmp/commandlinetools-linux-10406996_latest.zip
        -d ~/tmp
      shell: bash

    - run: mkdir ~/android-sdk/cmdline-tools/latest -p
      shell: bash
    - run: cp -r ~/tmp/cmdline-tools/* ~/android-sdk/cmdline-tools/latest
      shell: bash
    - run: ls ~/android-sdk/cmdline-tools/latest -a
      shell: bash
    - run: ls ~/android-sdk/cmdline-tools/latest/bin -a
      shell: bash
    - run: echo "${{ env.ANDROID_HOME }}/cmdline-tools/latest/bin" >> $GITHUB_PATH
      shell: bash

    - run: ls /home/runner/android-sdk/build-tools -a
      shell: bash

    - run: sdkmanager --licenses y
      shell: bash

    - run: sdkmanager --list
      shell: bash

    - run: sdkmanager --install "cmdline-tools;latest"
      shell: bash

    - run: sdkmanager --help
      shell: bash

    - run: echo "dev"
      shell: bash
