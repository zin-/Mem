name: "Run Android Medium test via native"
inputs:
  script:
    required: true
    type: string
  android-api-level:
    required: true
  android-target:
    required: true
  android-arch:
    required: true

runs:
  using: "composite"

  steps:
    - run: sudo apt update
      shell: bash

# TODO cache
    - name: "Install Android SDK"
      run:  sudo apt install android-sdk
      shell: bash
    - run: ls -a /usr/lib/android-sdk
      shell: bash

    - run: sudo cp -rf /usr/lib/android-sdk ~/android-sdk
      shell: bash
    - run: sudo chown -R $(id -u):$(id -g) ~/android-sdk
      shell: bash

    - run: mkdir -p ~/android-sdk/cmdline-tools/latest
      shell: bash

    - run: >
        wget
        -P ~/android-sdk/cmdline-tools/latest
        https://dl.google.com/android/repository/commandlinetools-linux-10406996_latest.zip
      shell: bash

    - run: >
        unzip
        -d ~/android-sdk/cmdline-tools/latest
        ~/android-sdk/cmdline-tools/latest/commandlinetools-linux-10406996_latest.zip
      shell: bash
    - run: ls -a ~/android-sdk/cmdline-tools/latest
      shell: bash
    - run: ls -a ~/android-sdk/cmdline-tools/latest/cmdline-tools
      shell: bash

    - run: ls -a
      shell: bash

    - run: |
        echo "export ANDROID_HOME=~/android-sdk"
        echo "export PATH=$PATH:$ANDROID_HOME/platform-tools/bin"
        echo "export PATH=$PATH:$ANDROID_HOME/cmdline-tools/latest/bin"
        echo "export PATH=$PATH:$ANDROID_HOME/tools/bin"
      shell: bash

    - run: sdkmanager -h
      shell: bash
    - run: where sdkmanager
      shell: bash

    - run: echo "dev"
      shell: bash
