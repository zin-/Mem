name: 'TMP Integration test'
on: push
env:
  flutter-version: 3.0.3
  flutter-channel: 'stable'
jobs:
  integration_test:
      strategy:
        fail-fast: false
        matrix:
          platform: [android, windows]
          include:
            - platform: android
              os: macos-latest
              android-api-level: 30
              android-tag: 'default'
              android-abi: 'x86_64'
              java-distribution: 'temurin'
              java-version: 17
            - platform: windows
              os: windows-latest
      name: 'Integration test(${{ matrix.platform }})'
      runs-on: ${{ matrix.os }}
      steps:
        - name: 'Checkout code'
          uses: actions/checkout@v3
        - name: 'Install Flutter'
          uses: ./.github/actions/install-flutter
          with:
            version: ${{ env.flutter-version }}
            channel: ${{ env.flutter-channel }}
        - name: 'Generate Localization code'
          uses: ./.github/actions/generate-localization_code
        - name: 'Prepare Test for Android'
          if: ${{ matrix.platform == 'android' }}
          uses: ./.github/actions/prepare-test_for-android
          with:
            android-api-level: ${{ matrix.android-api-level }}
            android-tag: ${{ matrix.android-tag }}
            android-abi: ${{ matrix.android-abi }}
            android-sdk-root: ${{ matrix.android-sdk-root }}
            java-distribution: ${{ matrix.java-distribution }}
            java-version: ${{ matrix.java-version }}
        - name: 'Flutter doctor'
          run: flutter doctor -v
        - run: flutter test integration_test -d ${{ matrix.platform }} --coverage
